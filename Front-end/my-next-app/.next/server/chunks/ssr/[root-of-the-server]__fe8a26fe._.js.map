{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/danil/OneDrive/Documentos/2025/P6/Projeto/Front-end/my-next-app/src/pages/accountPage.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport axios from \"axios\";\r\nimport \"../../public/css/products.css\";\r\nimport \"../../public/css/general.css\";\r\n\r\ninterface StoreData {\r\n  nome: string;\r\n  senha: string;\r\n  email: string;\r\n  cpf_cnpj_proprietario_loja: string;\r\n  data_nasc_proprietario: string;\r\n  telefone: string;\r\n  id_loja: string;\r\n}\r\n\r\nconst AccountPage = () => {\r\n  const router = useRouter();\r\n\r\n  const [storeData, setStoreData] = useState<StoreData>({\r\n    nome: \"\",\r\n    senha: \"\",\r\n    email: \"\",\r\n    cpf_cnpj_proprietario_loja: \"\",\r\n    data_nasc_proprietario: \"\",\r\n    telefone: \"\",\r\n    id_loja: \"\",\r\n  });\r\n\r\n  const [originalData, setOriginalData] = useState<StoreData | null>(null);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    const jwtToken = localStorage.getItem(\"jwtToken\");\r\n    const userData = localStorage.getItem(\"userData\");\r\n    if (!jwtToken || !userData) router.push(\"/initialPage\");\r\n  }, []);\r\n\r\n  const getAuthHeaders = () => {\r\n    const jwtToken = localStorage.getItem(\"jwtToken\");\r\n    return {\r\n      Authorization: `Bearer ${jwtToken}`,\r\n      \"Content-Type\": \"application/json\",\r\n    };\r\n  };\r\n\r\n  const getStore = async () => {\r\n    try {\r\n      const jwtToken = localStorage.getItem(\"jwtToken\");\r\n      const userData = localStorage.getItem(\"userData\");\r\n\r\n      if (!jwtToken || !userData) {\r\n        console.error(\"Usuário não autenticado.\");\r\n        return;\r\n      }\r\n\r\n      const { id_loja } = JSON.parse(userData);\r\n\r\n      const response = await axios.get(\r\n        `http://localhost:9700/api/lojas/${id_loja}`,\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${jwtToken}`,\r\n          },\r\n          timeout: 2000,\r\n        }\r\n      );\r\n\r\n      localStorage.setItem(\"selectedStore\", JSON.stringify(response.data));\r\n      return response.data;\r\n    } catch (error) {\r\n      alert(\"Erro desconhecido, tente novamente mais tarde.\");\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const loadStoreData = async () => {\r\n      const storeResponse = await getStore();\r\n\r\n      if (storeResponse && storeResponse.data) {\r\n        const data = storeResponse.data;\r\n        const parsed = {\r\n          nome: data.nome || \"\",\r\n          senha: data.senha || \"\",\r\n          email: data.email || \"\",\r\n          cpf_cnpj_proprietario_loja: data.cpf_cnpj_proprietario_loja || \"\",\r\n          data_nasc_proprietario: data.data_nasc_proprietario || \"\",\r\n          telefone: data.telefone || \"\",\r\n          id_loja: data.id_loja || \"\",\r\n        };\r\n        setStoreData(parsed);\r\n        setOriginalData(parsed);\r\n      } else {\r\n        const cachedStore = localStorage.getItem(\"selectedStore\");\r\n        if (cachedStore) {\r\n          try {\r\n            const parsedCachedStore = JSON.parse(cachedStore);\r\n            if (parsedCachedStore.data) {\r\n              const data = parsedCachedStore.data;\r\n              const parsed = {\r\n                nome: data.nome || \"\",\r\n                senha: data.senha || \"\",\r\n                email: data.email || \"\",\r\n                cpf_cnpj_proprietario_loja:\r\n                  data.cpf_cnpj_proprietario_loja || \"\",\r\n                data_nasc_proprietario: data.data_nasc_proprietario || \"\",\r\n                telefone: data.telefone || \"\",\r\n                id_loja: data.id_loja || \"\",\r\n              };\r\n              setStoreData(parsed);\r\n              setOriginalData(parsed);\r\n            }\r\n          } catch (parseError) {\r\n            console.error(\r\n              \"Erro ao parsear dados da loja do localStorage:\",\r\n              parseError\r\n            );\r\n            setError(\"Erro ao carregar dados armazenados da loja.\");\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    loadStoreData();\r\n  }, []);\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const { name, value } = e.target;\r\n    setStoreData((prev) => ({ ...prev, [name]: value }));\r\n  };\r\n\r\n  const hasStoreDataChanged = () => {\r\n    if (!originalData) return false;\r\n    return JSON.stringify(originalData) !== JSON.stringify(storeData);\r\n  };\r\n\r\n  const saveChanges = async () => {\r\n    try {\r\n      setIsSaving(true);\r\n\r\n      // Extrai senha e pega o resto dos dados\r\n      const { senha, ...dataWithoutPassword } = storeData;\r\n\r\n      await axios.patch(\r\n        `http://localhost:9700/api/lojas/${storeData.id_loja}`,\r\n        dataWithoutPassword, // envia sem a senha\r\n        { headers: getAuthHeaders() }\r\n      );\r\n\r\n      localStorage.setItem(\"userData\", JSON.stringify(storeData));\r\n      setOriginalData(storeData);\r\n    } catch (err) {\r\n      console.error(\"Erro ao salvar loja:\", err);\r\n      setError(\"Erro ao salvar loja\");\r\n      setTimeout(() => setError(\"\"), 3000);\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleBackClick = async () => {\r\n    if (hasStoreDataChanged()) {\r\n      await saveChanges();\r\n    }\r\n    router.push(\"/menuPage\");\r\n  };\r\n\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n  const deleteStore = async () => {\r\n    try {\r\n      setIsDeleting(true);\r\n      await axios.delete(\r\n        `http://localhost:9700/api/lojas/${storeData.id_loja}`,\r\n        { headers: getAuthHeaders() }\r\n      );\r\n      // Limpa o localStorage ao deletar a conta\r\n      localStorage.removeItem(\"jwtToken\");\r\n      localStorage.removeItem(\"userData\");\r\n      localStorage.removeItem(\"selectedStore\");\r\n\r\n      router.push(\"/initialPage\"); // redireciona para a página inicial\r\n    } catch (err) {\r\n      console.error(\"Erro ao deletar loja:\", err);\r\n      setError(\"Erro ao deletar loja\");\r\n      setTimeout(() => setError(\"\"), 3000);\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"d-flex justify-content-center align-items-center w-100\">\r\n      <div className=\"product-page d-flex justify-content-center align-items-center terciary p-4 flex-column rounded-5 white-light\">\r\n        <h3 className=\"col-12 text-center\">Editar Loja</h3>\r\n\r\n        {error && (\r\n          <div className=\"alert alert-danger col-12 text-center mt-2\">\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        {isSaving && (\r\n          <div className=\"alert alert-info col-12 text-center mt-2\">\r\n            Salvando dados...\r\n          </div>\r\n        )}\r\n        {isDeleting && (\r\n          <div className=\"alert alert-info col-12 text-center mt-2\">\r\n            Deletando conta...\r\n          </div>\r\n        )}\r\n\r\n        <form className=\"row w-100 justify-content-between\">\r\n          <div className=\"col-12 w-100\">\r\n            <div className=\"row product-info w-100 d-flex justify-content-between align-items-between\">\r\n              <div className=\"mx-auto col-12 p-4 info-base row\">\r\n                <h5 className=\"text-center mb-2\">Informações gerais</h5>\r\n\r\n                <label className=\"product-label\">Nome da loja:</label>\r\n                <input\r\n                  className=\"mb-3 produto-input\"\r\n                  name=\"nome\"\r\n                  placeholder=\"Nome\"\r\n                  value={storeData.nome}\r\n                  onChange={handleChange}\r\n                  required\r\n                />\r\n\r\n                <label className=\"product-label\">CPF/CNPJ*:</label>\r\n                <input\r\n                  className=\"mb-3 produto-input\"\r\n                  name=\"cpf_cnpj_proprietario_loja\"\r\n                  placeholder=\"Digite o CPF ou CNPJ\"\r\n                  value={storeData.cpf_cnpj_proprietario_loja}\r\n                  onChange={handleChange}\r\n                  required\r\n                />\r\n\r\n                <label className=\"product-label\">Email:</label>\r\n                <input\r\n                  className=\"mb-3 produto-input\"\r\n                  name=\"email\"\r\n                  placeholder=\"Digite o email\"\r\n                  value={storeData.email}\r\n                  onChange={handleChange}\r\n                  required\r\n                />\r\n\r\n                <label className=\"product-label\">Telefone:</label>\r\n                <input\r\n                  className=\"mb-3 produto-input\"\r\n                  name=\"telefone\"\r\n                  placeholder=\"Ex: (99) 99999-9999\"\r\n                  value={storeData.telefone}\r\n                  onChange={handleChange}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"d-flex justify-content-between w-100 mt-3\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"down-btn btn col-12 col-md-3 primaria\"\r\n              onClick={handleBackClick}\r\n              disabled={isSaving}\r\n            >\r\n              Voltar\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              className=\"down-btn btn col-12 col-md-3 primaria\"\r\n              onClick={deleteStore}\r\n            >\r\n              Deletar Loja\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AccountPage;\r\n"],"names":[],"mappings":"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","debugId":null}}]
}