{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/danil/OneDrive/Documentos/2025/P6/Projeto/Front-end/my-next-app/src/pages/employeesDetail.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport axios from \"axios\";\r\nimport \"../../public/css/products.css\";\r\nimport \"../../public/css/general.css\";\r\n\r\nconst EmployeeDetail = () => {\r\n  const router = useRouter();\r\n\r\n  const [employeeData, setEmployeeData] = useState({\r\n    id_funcionario: \"\",\r\n    nome: \"\",\r\n    email: \"\",\r\n    cpf: \"\",\r\n    data_nascimento: \"\", // será YYYY-MM-DD\r\n    telefone: \"\",\r\n    id_loja: \"\",\r\n  });\r\n\r\n  const [error, setError] = useState(\"\");\r\n\r\n  // Data original como veio do backend (ex: \"0200-07-20T03:06:28.000Z\")\r\n  const [originalDate, setOriginalDate] = useState<string>(\"\");\r\n\r\n  // Formata data para input type=\"date\"\r\n  const formatDateToInput = (dateString: string): string => {\r\n    if (!dateString) return \"\";\r\n    const date = new Date(dateString);\r\n    if (isNaN(date.getTime())) return \"\";\r\n\r\n    const year = date.getFullYear();\r\n    const month = String(date.getMonth() + 1).padStart(2, \"0\");\r\n    const day = String(date.getDate()).padStart(2, \"0\");\r\n\r\n    return `${year}-${month}-${day}`;\r\n  };\r\n\r\n  // Mantém o horário original, apenas atualiza dia/mês/ano\r\n  const updateDateKeepingTime = (\r\n    originalDateString: string,\r\n    newDateInput: string\r\n  ): string => {\r\n    const original = new Date(originalDateString);\r\n    const [year, month, day] = newDateInput.split(\"-\");\r\n\r\n    original.setFullYear(parseInt(year));\r\n    original.setMonth(parseInt(month) - 1); // Mês começa em 0\r\n    original.setDate(parseInt(day));\r\n\r\n    return original.toISOString(); // Retorna no formato ISO completo\r\n  };\r\n\r\n  // Carrega os dados iniciais\r\n  useEffect(() => {\r\n    const employee = localStorage.getItem(\"selectedEmployee\");\r\n    if (employee) {\r\n      const employeObj = JSON.parse(employee);\r\n      const data = employeObj.data;\r\n\r\n      const rawDate = data.data_nascimento;\r\n      setOriginalDate(rawDate);\r\n\r\n      setEmployeeData({\r\n        id_funcionario: data.id_funcionario || \"\",\r\n        nome: data.nome || \"\",\r\n        email: data.email || \"\",\r\n        cpf: data.cpf || \"\",\r\n        data_nascimento: formatDateToInput(rawDate),\r\n        telefone: data.telefone || \"\",\r\n        id_loja: data.id_loja,\r\n      });\r\n    }\r\n  }, []);\r\n\r\n  // Verifica autenticação\r\n  useEffect(() => {\r\n    const jwtToken = localStorage.getItem(\"jwtToken\");\r\n    const userData = localStorage.getItem(\"userData\");\r\n    if (!jwtToken || !userData) router.push(\"/initialPage\");\r\n  }, []);\r\n\r\n  const getAuthHeaders = () => {\r\n    const jwtToken = localStorage.getItem(\"jwtToken\");\r\n    return {\r\n      Authorization: `Bearer ${jwtToken}`,\r\n      \"Content-Type\": \"application/json\",\r\n    };\r\n  };\r\n\r\n  const handleChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const { name, value } = e.target;\r\n    const newData = { ...employeeData, [name]: value };\r\n    setEmployeeData(newData);\r\n\r\n    try {\r\n      let formattedValue = value;\r\n\r\n      if (name === \"data_nascimento\") {\r\n        formattedValue = updateDateKeepingTime(originalDate, value);\r\n      }\r\n\r\n      await axios.patch(\r\n        `http://localhost:9700/api/funcionarios/loja/${newData.id_loja}/funcionario/${newData.id_funcionario}`,\r\n        { [name]: formattedValue },\r\n        { headers: getAuthHeaders() }\r\n      );\r\n    } catch (err) {\r\n      console.error(\"Erro ao atualizar funcionário:\", err);\r\n      setError(\"Erro ao atualizar funcionário\");\r\n      setTimeout(() => setError(\"\"), 3000);\r\n    }\r\n  };\r\n\r\n  const deleteEmployee = async () => {\r\n    try {\r\n      await axios.delete(\r\n        `http://localhost:9700/api/funcionarios/loja/${employeeData.id_loja}/funcionario/${employeeData.id_funcionario}`,\r\n        { headers: getAuthHeaders() }\r\n      );\r\n      router.push(\"/employeesPage\");\r\n    } catch (err) {\r\n      console.error(\"Erro ao deletar funcionário:\", err);\r\n      setError(\"Erro ao deletar funcionário\");\r\n      setTimeout(() => setError(\"\"), 3000);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"d-flex justify-content-center align-items-center w-100\">\r\n      <div className=\"product-page d-flex justify-content-center align-items-center terciary p-4 flex-column rounded-5 white-light\">\r\n        <h3 className=\"col-12 text-center\">Editar funcionário</h3>\r\n\r\n        {error && (\r\n          <div className=\"alert alert-danger col-12 text-center mt-2\">\r\n            {error}\r\n          </div>\r\n        )}\r\n\r\n        <form className=\"row w-100 justify-content-between\">\r\n          <div className=\"col-12 w-100\">\r\n            <div className=\"row product-info w-100 d-flex justify-content-between align-items-between\">\r\n              <div className=\"mx-auto col-12 p-4 info-base row\">\r\n                <h5 className=\"text-center mb-2\">Informações do Funcionário</h5>\r\n\r\n                <label className=\"product-label\">Nome*:</label>\r\n                <input\r\n                  className=\"mb-3 produto-input\"\r\n                  name=\"nome\"\r\n                  placeholder=\"Ex: João da Silva\"\r\n                  value={employeeData.nome}\r\n                  onChange={handleChange}\r\n                  required\r\n                />\r\n\r\n                <label className=\"product-label\">Email*:</label>\r\n                <input\r\n                  className=\"mb-3 produto-input\"\r\n                  name=\"email\"\r\n                  placeholder=\"Ex: joao@email.com\"\r\n                  value={employeeData.email}\r\n                  onChange={handleChange}\r\n                  required\r\n                />\r\n\r\n                <label className=\"product-label\">CPF*:</label>\r\n                <input\r\n                  className=\"mb-3 produto-input\"\r\n                  name=\"cpf\"\r\n                  placeholder=\"Ex: 123.456.789-00\"\r\n                  value={employeeData.cpf}\r\n                  onChange={handleChange}\r\n                  required\r\n                />\r\n\r\n                <label className=\"product-label\">Data de Nascimento*:</label>\r\n                <input\r\n                  type=\"date\"\r\n                  className=\"mb-3 produto-input\"\r\n                  name=\"data_nascimento\"\r\n                  value={employeeData.data_nascimento}\r\n                  onChange={handleChange}\r\n                  required\r\n                />\r\n\r\n                <label className=\"product-label\">Telefone:</label>\r\n                <input\r\n                  className=\"mb-3 produto-input\"\r\n                  name=\"telefone\"\r\n                  placeholder=\"Ex: (11) 91234-5678\"\r\n                  value={employeeData.telefone}\r\n                  onChange={handleChange}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"d-flex justify-content-between w-100 mt-3\">\r\n            <button\r\n              type=\"button\"\r\n              className=\"down-btn btn col-12 col-md-3 primaria\"\r\n              onClick={() => router.push(\"/employeesPage\")}\r\n            >\r\n              Voltar\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              className=\"down-btn btn col-12 col-md-3 primaria\"\r\n              onClick={deleteEmployee}\r\n            >\r\n              Deletar Funcionário\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmployeeDetail;\r\n"],"names":[],"mappings":"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","debugId":null}}]
}