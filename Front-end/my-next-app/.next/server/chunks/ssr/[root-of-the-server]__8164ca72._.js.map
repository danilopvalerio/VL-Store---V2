{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 41, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/danil/OneDrive/Documentos/2025/P6/web/PROJETOS/VL-Store---V2-develop/Front-end/my-next-app/src/pages/employeesDetail.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport { useRouter } from \"next/router\";\nimport axios from \"axios\";\nimport \"../../public/css/products.css\";\nimport \"../../public/css/general.css\";\n\nconst EmployeeDetail = () => {\n  const router = useRouter();\n\n  const [employeeData, setEmployeeData] = useState({\n    id_funcionario: \"\",\n    nome: \"\",\n    email: \"\",\n    cpf: \"\",\n    data_nascimento: \"\", // será YYYY-MM-DD\n    telefone: \"\",\n    id_loja: \"\",\n  });\n\n  const [error, setError] = useState(\"\");\n\n  // Data original como veio do backend (ex: \"0200-07-20T03:06:28.000Z\")\n  const [originalDate, setOriginalDate] = useState<string>(\"\");\n\n  // Formata data para input type=\"date\"\n  const formatDateToInput = (dateString: string): string => {\n    if (!dateString) return \"\";\n    const date = new Date(dateString);\n    if (isNaN(date.getTime())) return \"\";\n\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, \"0\");\n    const day = String(date.getDate()).padStart(2, \"0\");\n\n    return `${year}-${month}-${day}`;\n  };\n\n  // Mantém o horário original, apenas atualiza dia/mês/ano\n  const updateDateKeepingTime = (\n    originalDateString: string,\n    newDateInput: string\n  ): string => {\n    const original = new Date(originalDateString);\n    const [year, month, day] = newDateInput.split(\"-\");\n\n    original.setFullYear(parseInt(year));\n    original.setMonth(parseInt(month) - 1); // Mês começa em 0\n    original.setDate(parseInt(day));\n\n    return original.toISOString(); // Retorna no formato ISO completo\n  };\n\n  // Carrega os dados iniciais\n  useEffect(() => {\n    const employee = localStorage.getItem(\"selectedEmployee\");\n    if (employee) {\n      const employeObj = JSON.parse(employee);\n      const data = employeObj.data;\n\n      const rawDate = data.data_nascimento;\n      setOriginalDate(rawDate);\n\n      setEmployeeData({\n        id_funcionario: data.id_funcionario || \"\",\n        nome: data.nome || \"\",\n        email: data.email || \"\",\n        cpf: data.cpf || \"\",\n        data_nascimento: formatDateToInput(rawDate),\n        telefone: data.telefone || \"\",\n        id_loja: data.id_loja,\n      });\n    }\n  }, []);\n\n  // Verifica autenticação\n  useEffect(() => {\n    const jwtToken = localStorage.getItem(\"jwtToken\");\n    const userData = localStorage.getItem(\"userData\");\n    if (!jwtToken || !userData) router.push(\"/initialPage\");\n  }, []);\n\n  const getAuthHeaders = () => {\n    const jwtToken = localStorage.getItem(\"jwtToken\");\n    return {\n      Authorization: `Bearer ${jwtToken}`,\n      \"Content-Type\": \"application/json\",\n    };\n  };\n\n  const handleChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value } = e.target;\n    const newData = { ...employeeData, [name]: value };\n    setEmployeeData(newData);\n\n    try {\n      let formattedValue = value;\n\n      if (name === \"data_nascimento\") {\n        formattedValue = updateDateKeepingTime(originalDate, value);\n      }\n\n      await axios.patch(\n        `http://localhost:9700/api/funcionarios/loja/${newData.id_loja}/funcionario/${newData.id_funcionario}`,\n        { [name]: formattedValue },\n        { headers: getAuthHeaders() }\n      );\n    } catch (err) {\n      console.error(\"Erro ao atualizar funcionário:\", err);\n      setError(\"Erro ao atualizar funcionário\");\n      setTimeout(() => setError(\"\"), 3000);\n    }\n  };\n\n  const deleteEmployee = async () => {\n    try {\n      await axios.delete(\n        `http://localhost:9700/api/funcionarios/loja/${employeeData.id_loja}/funcionario/${employeeData.id_funcionario}`,\n        { headers: getAuthHeaders() }\n      );\n      router.push(\"/employeesPage\");\n    } catch (err) {\n      console.error(\"Erro ao deletar funcionário:\", err);\n      setError(\"Erro ao deletar funcionário\");\n      setTimeout(() => setError(\"\"), 3000);\n    }\n  };\n\n  return (\n    <div className=\"d-flex justify-content-center align-items-center w-100\">\n      <div className=\"product-page d-flex justify-content-center align-items-center terciary p-4 flex-column rounded-5 white-light\">\n        <h3 className=\"col-12 text-center\">Editar funcionário</h3>\n\n        {error && (\n          <div className=\"alert alert-danger col-12 text-center mt-2\">\n            {error}\n          </div>\n        )}\n\n        <form className=\"row w-100 justify-content-between\">\n          <div className=\"col-12 w-100\">\n            <div className=\"row product-info w-100 d-flex justify-content-between align-items-between\">\n              <div className=\"mx-auto col-12 p-4 info-base row\">\n                <h5 className=\"text-center mb-2\">Informações do Funcionário</h5>\n\n                <label className=\"product-label\">Nome*:</label>\n                <input\n                  className=\"mb-3 produto-input\"\n                  name=\"nome\"\n                  placeholder=\"Ex: João da Silva\"\n                  value={employeeData.nome}\n                  onChange={handleChange}\n                  required\n                />\n\n                <label className=\"product-label\">Email*:</label>\n                <input\n                  className=\"mb-3 produto-input\"\n                  name=\"email\"\n                  placeholder=\"Ex: joao@email.com\"\n                  value={employeeData.email}\n                  onChange={handleChange}\n                  required\n                />\n\n                <label className=\"product-label\">CPF*:</label>\n                <input\n                  className=\"mb-3 produto-input\"\n                  name=\"cpf\"\n                  placeholder=\"Ex: 123.456.789-00\"\n                  value={employeeData.cpf}\n                  onChange={handleChange}\n                  required\n                />\n\n                <label className=\"product-label\">Data de Nascimento*:</label>\n                <input\n                  type=\"date\"\n                  className=\"mb-3 produto-input\"\n                  name=\"data_nascimento\"\n                  value={employeeData.data_nascimento}\n                  onChange={handleChange}\n                  required\n                />\n\n                <label className=\"product-label\">Telefone:</label>\n                <input\n                  className=\"mb-3 produto-input\"\n                  name=\"telefone\"\n                  placeholder=\"Ex: (11) 91234-5678\"\n                  value={employeeData.telefone}\n                  onChange={handleChange}\n                />\n              </div>\n            </div>\n          </div>\n\n          <div className=\"d-flex justify-content-between w-100 mt-3\">\n            <button\n              type=\"button\"\n              className=\"down-btn btn col-12 col-md-3 primaria\"\n              onClick={() => router.push(\"/employeesPage\")}\n            >\n              Voltar\n            </button>\n\n            <button\n              type=\"button\"\n              className=\"down-btn btn col-12 col-md-3 primaria\"\n              onClick={deleteEmployee}\n            >\n              Deletar Funcionário\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default EmployeeDetail;\n"],"names":[],"mappings":"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","debugId":null}}]
}